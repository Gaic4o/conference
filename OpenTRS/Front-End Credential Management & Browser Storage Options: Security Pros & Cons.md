# 보안적 관점에서의 Front-End 자격증명 정보관리와 브라우저 데이터 저장소 선택의 장/단점

[보안적 관점에서의 Front-End 자격증명 정보관리와 브라우저 데이터 저장소 선택의 장/단점](https://www.youtube.com/watch?v=XAcJ47CidhY&t=1062s)
발표자 : 박광호, Theori

## JWT 구성 요소

Header: 토큰의 타입(JWT) 와 해싱 알고리즘 (HS256, RS256 등) 정보가 있음.

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

Payload : 전달하고자 하는 정보(claims) 가 담겨 있음, 예를 들어 사용자의 ID, 발급자, 만료 시간 등이 있습니다.

```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true,
  "iat": 1516239022,
  "exp": 1516242622
}
```

Signature: 헤더의 인코딩 값, 페이로드의 인코딩 값, 비밀 키를 합친 뒤, 헤더에 명시된 알고리즘으로 해시하여 생성.

```json
HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  "your-256-bit-secret"
)
```

### 중요 Claims 설명

`sub` : 토큰의 주체, 즉 예로 사용자 ID 가 있을 수 있습니다.
`name` : 사용자의 이름과 같은 추가 정보를 제공.
`iat` : 토큰의 발급된 시간.
`jti` : 토큰에 대한 고유 식별자.
`exp` : 토큰의 만료 기간.

### JWT 프로토콜 흐름

1. 사용자 인증 : 사용자 로그인 정보 (이메일, 패스워드) 제출.
2. JWT 발급 : 서버가 사용자 인증 정보를 검증, JWT 생성하여 반환.
3. JWT 인증 : 사용자의 이후 요청에 JWT 를 포함하여 서버에 전송.
4. 서버 검증 : JWT 서명을 검증 후, 유효한 경우 요청을 처리.

## 주의 사항 및 권장 사항

보안적 문제: 예를 들어, `exp를 너무 길게 설정하면, 토큰이 오랜 기간 동안 유효하게 되어 보안 리스크가 증가합니다.` 반면, 너무 짧게 설정하면 사용자가 자주 로그인을 해야 하는 불편함이 있습니다.
서명(Sign)과 검증(Verify): 서명 과정은 토큰의 무결성을 보장하고, 검증 과정은 서버가 토큰의 유효성을 확인하는 데 사용됩니다. `안전하지 않은 secret이나 약한 알고리즘(alg: None)의 사용은 피해야 합니다.`
sub의 사용: `사용자의 고유 식별자(ID)를 사용하고, 예를 들어 사용자명 같은 변할 수 있는 정보는 사용하지 않는 것이 좋습니다.` 이는 데이터의 일관성과 보안을 유지하기 위함입니다.

### JWT vs 세션 인증

JWT (JSON Web Token)

- 클라이언트 측에서 관리되며, 서버에 HTTP 요청 시 액세스 토큰과 같이 전달이 됩니다.
- 서버는 토큰을 받아, 권한을 검증.
- 서버 측에세 변경 불가능, Payload 는 암호화 되지 않음
- 보안적 측면에서는, JWT 유효 기간 관리가 중요, 강력한 서명 알고리즘을 사용하는 것이 좋습니다.

세션 인증

- 클라이언트는 서버로부터 세션 ID를 받습니다.
- 이후 요청에는 이 세션 ID 포함하여 서버로 전송.
- 세션 데이터는 서버 측에 저장 가능, 클라이언트는 접근 불가능.
- 서버 측에서 세션 제어 가능, 보안 측면에서 데이터 보호를 위한 추가 조치를 할 수 있음.

### 브라우저 데이터 저장소의 보안

#### Cookie

- 보안적 측면 : `HttpOnly` 을 사용하여, Javascript 으로부터 보호 가능. `Secure` 속성을 통해 HTTPS 를 통해서만 쿠키를 전송되도록 할 수 있습니다.
  쿠키를 사용할 떄 데이터 암호화가 제공되지 않으므로, 암호화, 복호화를 해서 사용하기.
- 용량 제한 : 4KB

```http
Set-Cookie: <cookie-name>=<cookie-value>; HttpOnly
Set-Cookie: <cookie-name>=<cookie-value>; SameSite=Strict
Set-Cookie: <cookie-name>=<cookie-value>; SameSite=None
Set-Cookie: <cookie-name>=<cookie-value>; HttpOnly; Secure;
```

#### LocalStorage

유저 환경 설정, 로그인 정보, 유저 정보를 저장 할 떄 사용하기 좋음.

- 보안적 측면 쿠키처럼 악의적 자바스크립트 실행(XSS)으로부터, 데이터가 탈취 위험성이 있어서, 중요 데이터는 서버 측에서 처리하거나 암호화 하는 것이 좋습니다. 또는 쿠키에 데이터를 대신 저장하고 HTTP Only 을 사용하여 방어 할 수 있습니다.
- 용량 제한 : 5MB 내외

#### SessionStorage

- 탭이 열려 있는 동안만 데이터를 유지합니다. 탭을 닫으면 데이터가 소멸됩니다.
- 보안 측면에서는 LocalStorage와 유사하나, 브라우저 탭이 닫히면 데이터가 소멸되므로 일시적인 정보 저장에 적합합니다.
- 보안적 측면 : 로컬 스토리지와 마찬가지로. XSS 으로부터 데이터 탈취 위험성이 있어서, 중요 데이터는 암호화를 해서 저장하거나, 쿠키에 HTTP Only 옵션을 설정해서 사용하기(접근 차단).

### 정리

JWT 을 사용할 떄는 exp(만료일자) 을 짧게 사용하고, 안전하지 않는 secret 이나 약한 알고리즘(alg: None)을 사용해 피해야 합니다.
Cookie 을 사용할 떄는 보안적 이슈로 인해 꼭 HttpOnly, Secure 속성을 사용해야 하고,
LocalStorage, SessionStorage 을 사용할 떄 데이터 탈취 가능성이 있으므로, 번거롭지만 중요 데이터는 암호화를 해서 저장하거나, 쿠키에 데이터를 대신 저장 해 Http Only, Secure 을 사용 해, 방어를 할 수 있을 것 같습니다.
